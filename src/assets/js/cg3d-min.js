var cg3d=function(){function q(d,e,c){var b=0,a=new k(d);if(4!==a.getCols())throw p("Matrix of the three-dimensional object should have four columns!","cg-ob-001");r(e)&&(b=e[0].length);if(2!==b)throw p("Matrix of edges should have two columns!","cg-ob-002");if(!(c.segments&&c.points&&c.captions))throw p("Settings should have three properties: segments, points and captions!","cg-ob-003");this.getCopy=function(){var b=a.getElems();return new q(b,e,c)};this.getElems=function(){return a.getElems()};
this.applyTransformation=function(b){b instanceof l&&(a=a.multiply(b.getMatrix()).normolize())};this.trace=function(){a.trace()};this.getSegments=function(){for(var b=[],d=a.getElems(),t=e.length,g,f,h=0;h<t;h+=1)g=d[e[h][0]].slice(0,-1),f=d[e[h][1]].slice(0,-1),b.push({p1:{x:g[0],y:g[1],z:g[2]},p2:{x:f[0],y:f[1],z:f[2]}});return{coords:b,width:c.segments.width,color:c.segments.color}};this.getPoints=function(){var b=[],d=a.getElems(),e=a.getRows();a.getCols();for(var g,f=0;f<e;f+=1)g=d[f].slice(0,
-1),b.push({x:g[0],y:g[1],z:g[2]});return{coords:b,width:c.points.width,color:c.points.color}};this.getCaptions=function(){return{coords:this.getPoints().coords,texts:c.captions.texts||[],font:c.captions.font,color:c.captions.color}}}function l(d){var e=new k(d||[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]);this.trace=function(){e.trace()};this.getMatrix=function(){return e.getCopy()};this.getElems=function(){return e.getElems()};this.move=function(c,b){b=parseFloat(b);isNaN(b)&&(c="n");switch(c.toLowerCase()){case "z":var a=
[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,b,1]];break;case "x":a=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[b,0,0,1]];break;case "y":a=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,b,0,1]];break;default:a=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]}a=new k(a);e=e.multiply(a)};this.rotate=function(c,b){var a;b=parseFloat(b);isNaN(b)?c="n":a=b/180*Math.PI;switch(c.toLowerCase()){case "z":a=[[Math.cos(a),Math.sin(a),0,0],[-Math.sin(a),Math.cos(a),0,0],[0,0,1,0],[0,0,0,1]];break;case "x":a=[[1,0,0,0],[0,Math.cos(a),Math.sin(a),0],
[0,-Math.sin(a),Math.cos(a),0],[0,0,0,1]];break;case "y":a=[[Math.cos(a),0,-Math.sin(a),0],[0,1,0,0],[Math.sin(a),0,Math.cos(a),0],[0,0,0,1]];break;default:a=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]}a=new k(a);e=e.multiply(a)};this.rotateFree=function(c,b){var a={};lalgebra.checkSegment(c)?(a.x=c.p2.x-c.p1.x,a.y=c.p2.y-c.p1.y,a.z=c.p2.z-c.p1.z):a={x:0,y:0,z:1};b=parseFloat(b);isNaN(b)&&(b=0);a=lalgebra.cartesianToSpherical(a);this.move("x",-c.p1.x);this.move("y",-c.p1.y);this.move("z",-c.p1.z);this.rotate("z",
-a.a);this.rotate("y",-a.b);this.rotate("z",b);this.rotate("y",a.b);this.rotate("z",a.a);this.move("x",c.p1.x);this.move("y",c.p1.y);this.move("z",c.p1.z)};this.scale=function(c,b){b=parseFloat(b);isNaN(b)&&(c="n");switch(c.toLowerCase()){case "z":var a=[[1,0,0,0],[0,1,0,0],[0,0,b,0],[0,0,0,1]];break;case "x":a=[[b,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]];break;case "y":a=[[1,0,0,0],[0,b,0,0],[0,0,1,0],[0,0,0,1]];break;case "s":a=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,b]];break;default:a=[[1,0,0,0],[0,
1,0,0],[0,0,1,0],[0,0,0,1]]}a=new k(a);e=e.multiply(a)};this.perspective=function(c,b){b=parseFloat(b);isNaN(b)&&(c="n");switch(c.toLowerCase()){case "z":var a=[[1,0,0,0],[0,1,0,0],[0,0,1,b],[0,0,0,1]];break;case "x":a=[[1,0,0,b],[0,1,0,0],[0,0,1,0],[0,0,0,1]];break;case "y":a=[[1,0,0,0],[0,1,0,b],[0,0,1,0],[0,0,0,1]];break;default:a=[[1,0,0,0],[0,1,0,0],[0,0,1,0],[0,0,0,1]]}a=new k(a);e=e.multiply(a)}}var k=lalgebra.Matrix,p=lalgebra.errMsg,r=lalgebra.check2dArray;return{Object3d:q,Transform3d:l,
Scene3d:function(d,e,c){var b=[],a=new l,k=new l;if(!(d instanceof CanvasRenderingContext2D))throw p("Problem with a canvas context!","cg-sc-001");e=e||{x:0,y:0};k=new l;k.scale("y",-1);k.scale("s",1/c);k.move("x",e.x);k.move("y",e.y);this.clearObjects=function(a){a=parseInt(a);isNaN(a)?b.splice(0):b.splice(a,1)};this.addObject=function(a){b.push(a)};this.draw=function(){d.clearRect(0,0,d.canvas.width,d.canvas.height);for(var c=0,e=b.length;c<e;c+=1){var g=b[c].getCopy();g.applyTransformation(a);
g.applyTransformation(k);var f=g.getSegments(),h=f.coords;d.beginPath();for(var l=0,p=h.length;l<p;l+=1){var m=h[l].p1;var n=h[l].p2;d.moveTo(m.x,m.y);d.lineTo(n.x,n.y)}d.strokeStyle=f.color;d.lineWidth=f.width;d.stroke();f=g.getPoints();n=f.coords;m=f.width/2;d.fillStyle=f.color;h=0;for(l=n.length;h<l;h+=1)f=n[h],d.beginPath(),d.moveTo(f.x,f.y),d.arc(f.x,f.y,m,0,2*Math.PI,!0),d.fill();m=g.getCaptions();g=m.coords;n=m.texts;d.font=m.font;d.fillStyle=m.color;d.textBaseline="top";f=n.length<g.length?
n.length:g.length;for(h=0;h<f;h+=1)m=g[h],d.beginPath(),d.fillText(n[h],m.x+2,m.y+2),d.fill()}};this.setView=function(b,c){if(lalgebra.checkSegment(b)){var d=b.p1,f=b.p2,e={};e.x=f.x-d.x;e.y=f.y-d.y;e.z=f.z-d.z;f=lalgebra.vectorMagnitude(e);0!==f&&(a=new l,e=lalgebra.getAngles(e),a.move("x",-d.x),a.move("y",-d.y),a.move("z",-d.z),a.rotate("y",-e.a),a.rotate("x",-e.b+90),c&&a.perspective("z",-1/f))}}}}}();