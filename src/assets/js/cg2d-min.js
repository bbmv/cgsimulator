var cg2d=function(){function t(e,f,b){var c=0,d=new p(e);if(3!==d.getCols())throw q("Matrix of the two-dimensional object should have three columns!","cg-ob-001");u(f)&&(c=f[0].length);if(2!==c)throw q("Matrix of edges should have two columns!","cg-ob-002");if(!(b.segments&&b.points&&b.captions))throw q("Settings should have three properties: segments, points and captions!","cg-ob-003");this.getCopy=function(){var c=d.getElems();return new t(c,f,b)};this.getElems=function(){return d.getElems()};this.applyTransformation=
function(b){b instanceof r&&(d=d.multiply(b.getMatrix()).normolize())};this.trace=function(){d.trace()};this.getSegments=function(){for(var c=[],e=d.getElems(),m=f.length,g,h,l=0;l<m;l+=1)g=e[f[l][0]].slice(0,-1),h=e[f[l][1]].slice(0,-1),c.push({p1:{x:g[0],y:g[1]},p2:{x:h[0],y:h[1]}});return{coords:c,width:b.segments.width,color:b.segments.color}};this.getPoints=function(){var c=[],e=d.getElems(),f=d.getRows();d.getCols();for(var g,h=0;h<f;h+=1)g=e[h].slice(0,-1),c.push({x:g[0],y:g[1]});return{coords:c,
width:b.points.width,color:b.points.color}};this.getCaptions=function(){return{coords:this.getPoints().coords,texts:b.captions.texts||[],font:b.captions.font,color:b.captions.color}}}function r(e){var f=new p(e||[[1,0,0],[0,1,0],[0,0,1]]);this.trace=function(){f.trace()};this.getMatrix=function(){return f.getCopy()};this.getElems=function(){return f.getElems()};this.shear=function(b,c){c=parseFloat(c);isNaN(c)&&(b="n");switch(b.toLowerCase()){case "x":var d=[[1,0,0],[c,1,0],[0,0,1]];break;case "y":d=
[[1,c,0],[0,1,0],[0,0,1]];break;default:d=[[1,0,0],[0,1,0],[0,0,1]]}d=new p(d);f=f.multiply(d)};this.move=function(b,c){c=parseFloat(c);isNaN(c)&&(b="n");switch(b.toLowerCase()){case "x":var d=[[1,0,0],[0,1,0],[c,0,1]];break;case "y":d=[[1,0,0],[0,1,0],[0,c,1]];break;default:d=[[1,0,0],[0,1,0],[0,0,1]]}d=new p(d);f=f.multiply(d)};this.rotate=function(b){b=parseFloat(b);isNaN(b)?b=[[1,0,0],[0,1,0],[0,0,1]]:(b=lalgebra.degreeToRadian(b),b=[[Math.cos(b),Math.sin(b),0],[-Math.sin(b),Math.cos(b),0],[0,
0,1]]);b=new p(b);f=f.multiply(b)};this.rotateFree=function(b,c){if(b.x&&b.y){var d=b.x;var e=b.y}else e=d=0;c=parseFloat(c);isNaN(c)&&(c=0);a=lalgebra.degreeToRadian(c);this.move("x",-d);this.move("y",-e);this.rotate(a);this.move("x",d);this.move("y",e)};this.scale=function(b,c){c=parseFloat(c);isNaN(c)&&(b="n");switch(b.toLowerCase()){case "x":var d=[[c,0,0],[0,1,0],[0,0,1]];break;case "y":d=[[1,0,0],[0,c,0],[0,0,1]];break;case "s":d=[[1,0,0],[0,1,0],[0,0,c]];break;default:d=[[1,0,0],[0,1,0],[0,
0,1]]}d=new p(d);f=f.multiply(d)}}var p=lalgebra.Matrix,q=lalgebra.errMsg,u=lalgebra.check2dArray;return{Object2d:t,Transform2d:r,Scene2d:function(e,f,b){var c=[],d=new r;if(!(e instanceof CanvasRenderingContext2D))throw q("Problem with a canvas context!","cg-sc-001");f=f||{x:0,y:0};d=new r;d.scale("y",-1);d.scale("s",1/b);d.move("x",f.x);d.move("y",f.y);this.clearObjects=function(b){b=parseInt(b);isNaN(b)?c.splice(0):c.splice(b,1)};this.addObject=function(b){c.push(b)};this.draw=function(){e.clearRect(0,
0,e.canvas.width,e.canvas.height);for(var b=0,f=c.length;b<f;b+=1){var m=c[b].getCopy();m.applyTransformation(d);var g=m.getSegments(),h=g.coords;e.beginPath();for(var l=0,p=h.length;l<p;l+=1){var k=h[l].p1;var n=h[l].p2;e.moveTo(k.x,k.y);e.lineTo(n.x,n.y)}e.strokeStyle=g.color;e.lineWidth=g.width;e.stroke();g=m.getPoints();n=g.coords;k=g.width/2;e.fillStyle=g.color;h=0;for(l=n.length;h<l;h+=1)g=n[h],e.beginPath(),e.moveTo(g.x,g.y),e.arc(g.x,g.y,k,0,2*Math.PI,!0),e.fill();k=m.getCaptions();m=k.coords;
n=k.texts;e.font=k.font;e.fillStyle=k.color;e.textBaseline="top";g=n.length<m.length?n.length:m.length;for(h=0;h<g;h+=1)k=m[h],e.beginPath(),e.fillText(n[h],k.x+2,k.y+2),e.fill()}}}}}();